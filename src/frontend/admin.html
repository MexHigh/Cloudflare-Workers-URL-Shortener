<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="centered">
        <h2>Admin panel</h2>
        <form>
            <label for="name">Shortlink name</label><br>
            <input type="text" id="name" name="name"><br><br>
    
            <label for="target">Shortlink target URL</label><br>
            <input type="url" id="target" name="target"><br><br>
    
            <input type="submit" value="Add shortlink">
        </form>
        <p></p>
    </div>
    <script>
        function getUrlShortenerToken() {
            let cookies = `; ${document.cookie}`;
            let parts = cookies.split(`; url-shortener-token=`)
            if (parts.length === 2) return parts.pop().split(";").shift() 
        }

        function handleSubmit(event) {
            event.preventDefault()
            let data = new FormData(event.target)
            let values = Object.fromEntries(data.entries())

            let resMsg = document.querySelector("p")
            let token = getUrlShortenerToken()
            if (!token) {
                resMsg.innerHTML = "Unable to retrieve token from cookie, please go to /admin/login"
                return false
            }

            fetch("/api/shortlink", {
                method: "POST",
                headers: {
                    "x-api-key": token
                },
                body: JSON.stringify({
                    "name": values.name,
                    "target": values.target
                })
            }).then(async (r) => {
                resMsg.innerHTML = await r.text()
            })
        }
        let form = document.querySelector("form");
        form.addEventListener("submit", handleSubmit);
    </script>
</body>